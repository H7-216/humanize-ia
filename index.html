<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Snaply - Ton Monde en Snap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #ffe600;
      color: #000;
    }
    header {
      background: #000;
      color: #ffe600;
      padding: 1em;
      text-align: center;
    }
    nav a {
      margin: 0 10px;
      color: #ffe600;
      text-decoration: none;
      font-weight: bold;
    }
    main {
      padding: 2em;
    }
    .btn {
      background: #000;
      color: #ffe600;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    .chat-box, .story-box, .profile-box {
      margin-top: 2em;
      padding: 1em;
      background: white;
      border-radius: 8px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .message, .story {
      padding: 8px;
      background: #f4f4f4;
      border-radius: 6px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Snaply</h1>
    <nav>
      <a href="#accueil">Accueil</a>
      <a href="#chat">Discuter</a>
      <a href="#stories">Stories</a>
      <a href="#profil">Profil</a>
    </nav>
  </header>

  <main>
    <section id="accueil">
      <h2>Bienvenue sur Snaply</h2>
      <p>Exprime-toi avec des snaps et des stories !</p>
      <button class="btn" onclick="scrollToSection('chat')">Commencer à discuter</button>
    </section>

    <section id="chat" class="chat-box">
      <h3>💬 Discuter</h3>
      <div id="messages"></div>
      <textarea id="messageInput" placeholder="Écris ton message..."></textarea>
      <button class="btn" onclick="sendMessage()">Envoyer</button>
    </section>

    <section id="stories" class="story-box">
      <h3>📸 Stories</h3>
      <input type="file" id="storyInput" />
      <button class="btn" onclick="uploadStory()">Ajouter une story</button>
      <div id="storyList"></div>
    </section>

    <section id="profil" class="profile-box">
      <h3>👤 Profil</h3>
      <p id="userEmail">Non connecté</p>
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Mot de passe" />
      <button class="btn" onclick="login()">Connexion</button>
      <button class="btn" onclick="signup()">Inscription</button>
      <button class="btn" onclick="logout()">Déconnexion</button>
    </section>
  </main>

  <script type="module">
    // ✅ Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL, listAll, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

    // ⚙️ Ta config Firebase (à modifier avec la tienne)
    const firebaseConfig = {
      apiKey: "TA_CLE_API",
      authDomain: "TON_DOMAINE.firebaseapp.com",
      databaseURL: "https://TON_DOMAINE.firebaseio.com",
      projectId: "TON_PROJET_ID",
      storageBucket: "TON_PROJET_ID.appspot.com",
      messagingSenderId: "XXX",
      appId: "APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const storage = getStorage(app);

    const userEmail = document.getElementById("userEmail");

    onAuthStateChanged(auth, user => {
      if (user) {
        userEmail.textContent = "Connecté : " + user.email;
        loadMessages();
        loadStories();
      } else {
        userEmail.textContent = "Non connecté";
      }
    });

    // Auth
    window.login = () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      signInWithEmailAndPassword(auth, email, password)
        .catch(err => alert("Erreur : " + err.message));
    };

    window.signup = () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      createUserWithEmailAndPassword(auth, email, password)
        .catch(err => alert("Erreur : " + err.message));
    };

    window.logout = () => signOut(auth);

    // Chat
    window.sendMessage = () => {
      const input = document.getElementById("messageInput");
      const msg = input.value.trim();
      if (!msg || !auth.currentUser) return;
      push(ref(db, "messages"), {
        user: auth.currentUser.email,
        text: msg,
        time: Date.now()
      });
      input.value = "";
    };

    function loadMessages() {
      const messagesDiv = document.getElementById("messages");
      onValue(ref(db, "messages"), snap => {
        messagesDiv.innerHTML = "";
        snap.forEach(child => {
          const { user, text } = child.val();
          const div = document.createElement("div");
          div.className = "message";
          div.textContent = `${user}: ${text}`;
          messagesDiv.appendChild(div);
        });
      });
    }

    // Stories
    window.uploadStory = () => {
      const file = document.getElementById("storyInput").files[0];
      if (!file || !auth.currentUser) return;

      const fileRef = sRef(storage, "stories/" + Date.now() + "_" + file.name);
      uploadBytes(fileRef, file).then(() => {
        alert("Story envoyée !");
        loadStories();
      });
    };

    function loadStories() {
      const listRef = sRef(storage, "stories/");
      listAll(listRef).then(res => {
        const listDiv = document.getElementById("storyList");
        listDiv.innerHTML = "";
        res.items.forEach(itemRef => {
          getDownloadURL(itemRef).then(url => {
            const img = document.createElement("img");
            img.src = url;
            img.style = "width:100%;max-width:200px;margin:5px;";
            listDiv.appendChild(img);
          });
        });
      });
    }

    // Scroll navigation
    function scrollToSection(id) {
      document.getElementById(id).scrollIntoView({ behavior: "smooth" });
    }
    window.scrollToSection = scrollToSection;
  </script>
</body>
</html>